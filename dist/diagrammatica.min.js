!function(a,b){"use strict";function c(){if("number"==typeof window.scrollX&&"number"==typeof window.scrollY)return{x:window.scrollX,y:window.scrollY};if("number"==typeof window.pageXOffset&&"number"==typeof window.pageYOffset)return{x:window.pageXOffset,y:window.pageYOffset};var a=document.documentElement||document.body.parentNode;return("number"!=typeof a.ScrollLeft||"number"!=typeof a.ScrollTop)&&(a=document.body),{x:a.scrollLeft,y:a.scrollTop}}function d(a){return a instanceof d3.selection||check.array(a)&&"string"!=typeof a[0]}function e(a,b){function c(){f.xScale.domain(i.brush.empty()?i.chart.xScale.domain():i.brush.extent()),t.selectAll("path").attr("d",function(a){return p(a.data)}),f.renderArea.select(".x.axis").call(f.xAxis),t.selectAll(".dots").attr("cx",function(a){return f.xScale(a.x)}),z(b),o()}var e=this;e.data=b,a=this.selection=d(a)?a:d3.select(a);var f=this.chart=new h(a,"line"),g=f.config;g.margin.bottom=100,g.margin.top=25;var i=this.brushData={chart:{}};i.config={margin:{top:function(){return g.paddedHeight()+45},right:g.margin.right,bottom:10,left:g.margin.left},height:function(){return g.height-i.config.margin.top()-i.config.margin.bottom}},g.dotSize=3;var j=d3.time.format("%B %Y"),k=this.updateX=function(){f.xScale=d3.time.scale().range([0,g.paddedWidth()]),f.xAxis=d3.svg.axis().scale(f.xScale).orient("bottom"),i.chart.xScale=d3.time.scale().range([0,g.paddedWidth()]),i.chart.xAxis=d3.svg.axis().scale(i.chart.xScale).orient("bottom")};k();var l=this.updateY=function(){f.yScale=d3.scale.linear().range([g.paddedHeight(),0]),i.chart.yScale=d3.scale.linear().range([i.config.height(),0]).domain([0,d3.max(b,function(a){return d3.max(a.data,function(a){return a.y})})]),f.yAxis=d3.svg.axis().scale(f.yScale).orient("left")};l();var m=this.dateRange=function(){var a=moment(i.westDate),b=moment(i.eastDate),c=moment(b.diff(a)),d=c.diff(moment(0),"years"),e=c.diff(moment(0),"months")-12*d;return d+" year(s), "+e+" month(s)"},o=this.sendBrushData=function(){var a=document.createEvent("CustomEvent");i.westDate=i.brush.extent()[0],i.eastDate=i.brush.extent()[1],i.range.select("#fromDate").text(j(i.westDate)).transition().duration(g.transitionDuration),i.range.select("#toDate").text(j(i.eastDate)).transition().duration(g.transitionDuration).attr("transform","translate("+g.paddedWidth()+",-5)"),i.range.select("#range").transition().duration(g.transitionDuration).text(m()).attr("transform","translate("+g.paddedWidth()/2+",-5)"),a.initCustomEvent("brushEvent",!0,!0,{fromDate:i.westDate,toDate:i.eastDate,data:b}),document.dispatchEvent(a)},p=this.lineGenerator=d3.svg.line().x(function(a){return f.xScale(a.x)}).y(function(a){return f.yScale(a.y)}),q=this.brushLineGenerator=d3.svg.line().x(function(a){return f.xScale(a.x)}).y(function(a){return i.chart.yScale(.9*a.y)});f.xScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.x})})]),f.yScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.y})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.y})})]),i.chart.xScale.domain(f.xScale.domain()),i.brush=d3.svg.brush().x(i.chart.xScale).on("brush",c).extent([d3.min(b,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.x})})]),i.westDate=i.brush.extent()[0],i.eastDate=i.brush.extent()[1],i.uniqueClipId="clip"+(i.eastDate-i.westDate),i.range=f.renderArea.append("g"),i.range.append("text").attr("id","fromDate").text(j(i.westDate)).attr("transform","translate(0,-5)").style("text-anchor","start").style("font-weight","bold"),i.range.append("text").attr("id","toDate").text(j(i.eastDate)).attr("transform","translate(0,-5)").style("text-anchor","end").style("font-weight","bold"),i.range.append("text").attr("id","range").text(m()).attr("transform","translate(0,-5)").style("text-anchor","middle").style("font-weight","bold"),i.clipping=f.renderArea.append("defs").append("clipPath").attr("id",i.uniqueClipId).append("rect").attr("transform","translate("+-1*g.dotSize+","+-1*g.dotSize+")").attr("width",g.paddedWidth()+2*g.dotSize).attr("height",g.paddedHeight()+2*g.dotSize);var r=this.focus=f.renderArea.append("g").attr("class","focus");r.append("g").attr("class","x axis").attr("transform","translate(0,"+g.paddedHeight()+")").call(f.xAxis).append("text").attr("class","x label").attr("text-anchor","middle").attr("x",g.paddedWidth()/2).attr("y",28).text(""),r.append("g").attr("class","y axis").call(f.yAxis).append("text").attr("class","y label").attr("transform","rotate(-90)").attr("y",-1*g.margin.left).attr("x",g.paddedHeight()/2*-1).attr("dy","1em").style("text-anchor","middle").text("");var s=this.context=f.renderArea.append("g").attr("class","context").attr("transform","translate(0,"+i.config.height()+")"),t=this.series=r.selectAll("series").data(b).enter().append("g").attr("class","series"),u=t.append("path").attr("class","line").attr("clip-path","url(#"+i.uniqueClipId+")").attr("d",function(a){return p(a.data)}).style("stroke",function(a){return f.colors(a.name)}),v=t.selectAll("dots").data(function(a){return a.data.map(function(b){b.name=a.name}),a.data}).enter().append("circle").classed("dots",!0).attr("r",g.dotSize).attr("clip-path","url(#"+i.uniqueClipId+")").attr("cy",function(a){return f.yScale(a.y)}).attr("cx",function(a){return f.xScale(a.x)}).attr("fill",function(a){return f.colors(a.name)});i.series=s.selectAll("series").data(b).enter().append("g").attr("class","series"),i.series.append("path").attr("class","line").attr("d",function(a){return q(a.data)}).style("stroke",function(a){return f.colors(a.name)}),s.append("g").attr("class","x axis").attr("transform","translate("+-1*g.paddedWidth()+","+i.config.height()+")").call(i.chart.xAxis),s.append("g").attr("class","x brush").call(i.brush).selectAll("rect").attr("height",i.config.height()),s.selectAll(".resize").append("rect").attr("x",-3).attr("y",0).attr("width",6).attr("class","handle");var w=f.renderArea.append("g").attr("class","hover-line"),x=w.append("line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",g.paddedHeight());x.style("opacity",0);var y=f.renderArea.append("g").attr("class","tooltip-rect-group");g.tooltipHtml=function(a){var b="";return b+='<div class="diagrammatica-tooltip-content">',b+=a.length>0?'<div class="diagrammatica-tooltip-title">'+j(a[0].x)+"</div>":"",a.forEach(function(a){b+='<svg height="10" width="10"><rect height="10" width="10" fill="'+f.colors(a.name)+'"></rect></svg>',b+="<span> "+a.name+"</span> : "+a.y+"<br>"}),b+="</div>"};var z=this.renderTooltip=function(a){x.attr("y2",g.paddedHeight()),y.selectAll(".tooltip-rect").remove();var b=d3.set(a.map(function(a){return a.data}).reduce(function(a,b){return a.concat(b)}).map(function(a){return a.x})).values().map(function(a){return new Date(a)}),c=g.paddedWidth()/b.length,d=c/2;y.selectAll(".tooltip-rect").data(b).enter().append("rect").attr("height",g.paddedHeight()).attr("width",c).attr("opacity",0).attr("clip-path","url(#"+i.uniqueClipId+")").classed("tooltip-rect",!0).classed("diagrammatica-tooltip-target",!0).attr("x",function(a){return f.xScale(a)-d}).on("mouseover",function(c){x.attr("x1",f.xScale(c)).attr("x2",f.xScale(c)).attr("clip-path","url(#"+i.uniqueClipId+")").style("opacity",1),n.transition().style("opacity",1);var d=this.getBoundingClientRect(),e=n.node().getBoundingClientRect(),h=d.left+d.width/2;h+=c===b.length[b.length-1]?-Math.abs(e.width+10):10;var j=a.map(function(a){var b=a.data.filter(function(a){return a.x.toString()===c.toString()}),d=1===b.length?b[0]:{};return d.name=a.name,d});v.transition().attr("cy",function(a){return f.yScale(a.y)}).attr("cx",function(a){return f.xScale(a.x)}).attr("r",function(a){var b=j.filter(function(b){return a===b});return b.length>0?2*g.dotSize:g.dotSize}),n.html(g.tooltipHtml(j)).style("left",h+"px").style("top",d3.event.pageY+"px")}).on("mousemove",function(){n.style("top",d3.event.pageY+"px")}).on("mouseout",function(){x.style("opacity",0),n.style("opacity",0),v.transition().attr("cy",function(a){return f.yScale(a.y)}).attr("cx",function(a){return f.xScale(a.x)}).attr("r",g.dotSize)})};z(b);var A=f.renderArea.append("g").attr("class","legend"),B=this.renderLegend=function(a){var b,c=a.map(function(a){return{name:a.name}}),d=A.selectAll("g").data(c).enter().append("g").attr("class","legend-item").on("mouseover",function(a){d.transition().attr("opacity",function(b){return a===b?1:.3}),u.transition().attr("opacity",function(b){return a.name===b.name?1:0}),v.transition().attr("opacity",function(b){return a.name===b.name?1:0})}).on("mouseout",function(){check.object(b)?(d.transition().attr("opacity",function(a){return a===b?1:.3}),u.transition().attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0}),v.transition().attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0})):(d.transition().attr("opacity",1),u.transition().attr("opacity",1),v.transition().attr("opacity",1))}).on("click",function(c){b=b===c?null:c,check.object(b)?(u.attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0}),v.attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0}),z(a.filter(function(a){return a.name===b.name}))):(u.attr("opacity",1),v.attr("opacity",1),z(a))});d.append("text").text(function(a){return a.name}).attr("transform",function(a,b){return"translate(0,"+15*b+")"}).each(function(a){a.width=this.getBBox().width}),d.append("rect").attr("class","legend-item-swatch").attr("height",10).attr("width",10).attr("x",-12).attr("y",-10).attr("transform",function(a,b){return"translate(0,"+15*b+")"}).attr("fill",function(a){return f.colors(a.name)}),f.hasRenderedOnce?A.transition().duration(g.transitionDuration).attr("transform","translate("+(g.paddedWidth()+35)+",0)"):A.attr("transform","translate("+(g.paddedWidth()+35)+",0)")};B(b),o()}b.diagrammatica=a;var f=function(a,b,c){a=this.selection=d(a)?a:d3.select(a),this.data=b;var e=this.chart=new h(this.selection,"bar"),f=this.config=e.config;c=this.orientation=c||"horizontal";var g=this.isHorizontal=function(){return"horizontal"===c};e.xScale=d3.scale.ordinal(),e.yScale=d3.scale.linear(),this.updateX=function(a){b=check.defined(a)?a:b;var c=g()?[0,f.paddedHeight()]:[0,f.paddedWidth()];e.xScale.domain(b.map(function(a){return a.name})).rangeRoundBands(c,.1);var d=g()?"left":"bottom";e.xAxis=d3.svg.axis().scale(e.xScale).orient(d)},this.updateY=function(a){b=check.defined(a)?a:b,e.yScale.domain([0,d3.max(b,function(a){return a.value})]);var c=g()?[0,f.paddedWidth()]:[f.paddedHeight(),0];e.yScale.range(c);var d=g()?"bottom":"left";e.yAxis=d3.svg.axis().scale(e.yScale).orient(d)},this.updateX(),this.updateY(),f.tooltipHtml=function(a){var b='<div class="left-arrow diagrammatica-tooltip-inline"></div>';return b+='<div class="diagrammatica-tooltip-content diagrammatica-tooltip-inline">'+a.value+"</div>"}};f.prototype.renderAxis=function(a){var b=this.chart,c=this.config,d=b.renderArea.append("g").attr("class",a+" axis").call(b[a+"Axis"]),e=d.append("text").attr("class",a+" label").attr("text-anchor","middle");return this.isHorizontal()&&"x"===a||!this.isHorizontal()&&"y"===a?e.attr("transform","rotate(-90)").attr("x",c.paddedHeight()/2*-1).attr("y",-1*c.margin.left).attr("dy","1em"):(d.attr("transform","translate(0,"+c.paddedHeight()+")"),e.attr("x",c.paddedWidth()/2).attr("y",28)),this},f.prototype.renderBars=function(){var a=this.chart,b=this.data,d=this.config;this.bars=a.renderArea.selectAll(".bar").data(b).enter().append("rect").attr("class","bar diagrammatica-tooltip-target").attr("fill",function(b){return a.colors(b.value)}).on("mouseover",function(a){n.transition().style("opacity",1);var b=this.getBoundingClientRect(),e=n.node().getBoundingClientRect(),f=(b.height-e.height)/2;n.html(d.tooltipHtml(a)).style("left",b.right+"px").style("top",b.top+c().y+f+"px")}).on("mouseout",function(){n.style("opacity",0)});var e=0,f=function(b){return a.xScale(b.name)},g=function(b){return a.yScale(b.value)},h=a.xScale.rangeBand();return this.isHorizontal()||(e=function(b){return a.xScale(b.name)},f=function(b){return a.yScale(b.value)},g=a.xScale.rangeBand(),h=function(b){return d.paddedHeight()-a.yScale(b.value)}),this.bars.attr("x",e).attr("y",f).attr("width",g).attr("height",h),this},f.prototype.render=function(){return this.renderAxis("x"),this.renderAxis("y"),this.renderBars(),this},f.prototype.updateAxes=function(a){var b=this.chart,c=this.config;this.updateY(a);var d=b.renderArea.select(".y.axis").transition().duration(c.transitionDuration).call(b.yAxis);this.updateX(a);var e=b.renderArea.select(".x.axis").transition().duration(c.transitionDuration).call(b.xAxis),f=this.isHorizontal()?d:e;return f.attr("transform","translate(0,"+c.paddedHeight()+")"),this},f.prototype.updateBars=function(a){var b=this.chart,c=this.bars,d=this.config,e=c.data(a).transition().duration(d.transitionDuration);this.isHorizontal()?e.attr("y",function(a){return b.xScale(a.name)}).attr("width",function(a){return b.yScale(a.value)}).attr("height",b.xScale.rangeBand()):e.attr("x",function(a){return b.xScale(a.name)}).attr("y",function(a){return b.yScale(a.value)}).attr("width",b.xScale.rangeBand()).attr("height",function(a){return d.paddedHeight()-b.yScale(a.value)})};var g=function(a,b,c){var d=new f(a,b,c).render(),e=d.chart,g=d.config,h=d.updateX,i=d.updateY,j=d.bars,k=e.update=function(a){b=check.defined(a)?a:b,d.updateAxes(b),d.updateBars(b)};return k.height=function(a){var b=d.isHorizontal()?"x":"y";return e.height(a,function(){h(),d.selection.select("."+b+".axis .label").transition().duration(g.transitionDuration).attr("y",-1*g.margin.left).attr("x",g.paddedHeight()/2*-1)})},k.width=function(a){var b=d.isHorizontal()?"y":"x";return e.width(a,function(){i(),d.selection.select("."+b+".axis .label").transition().duration(g.transitionDuration).attr("x",g.paddedWidth()/2).attr("y",28)})},k.yAxisLabelText=function(a){return e.yAxisLabelText(a)},k.xAxisLabelText=function(a){return e.xAxisLabelText(a)},k.chartBase=function(){return e},k.updateY=function(){return i},k.updateX=function(){return h},k.bars=function(){return j},k},h=function(a,b){this.hasRenderedOnce=!1,this.selection=d(a)?a:d3.select(a),this.update=function(){};var c={margin:{top:20,right:20,bottom:30,left:40},width:480,height:250,transitionDuration:500};this.config=c,this.config.paddedWidth=function(){return c.width-c.margin.left-c.margin.right},this.config.paddedHeight=function(){var a=c.height-c.margin.top-c.margin.bottom;if(0>=a)throw"Padded height ("+a+") of chart should be greater than 0. Increase its height or decrease its top/bottom margin.";return a},this.config.tooltipHtml=function(){return"tooltip content"},this.svg=this.selection.append("svg").attr("class","diagrammatica diagrammatica-"+b).attr("width",c.width).attr("height",c.height),this.renderArea=this.svg.append("g").attr("transform","translate("+c.margin.left+","+c.margin.top+")"),this.updateDimensions=function(){this.svg.attr("width",c.width).attr("height",c.height),this.renderArea.attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")")},this.xScale=function(){},this.xAxis=function(){},this.yScale=function(){},this.yAxis=function(){};var e=["#FD7C6E","#87A96B","#78DBE2","#1F75FE","#A2A2D0","#6699CC","#0D98BA","#7366BD","#CD9575","#FFA474","#FAE7B5","#9F8170","#ACE5EE","#DE5D83","#CB4154","#B4674D","#FF7F49","#EA7E5D","#B0B7C6","#FFFF99","#00CC99","#FFAACC","#DD4492","#1DACD6","#BC5D58","#DD9475","#9ACEEB","#FFBCD9","#FDDB6D","#2B6CC4","#EFCDB8","#6E5160","#CEFF1D","#71BC78","#6DAE81","#C364C5","#CC6666","#E7C697","#FCD975","#A8E4A0","#95918C","#1CAC78","#1164B4","#F0E891","#FF1DCE","#B2EC5D","#5D76CB","#CA3767","#3BB08F","#FEFE22","#FCB4D5","#FFF44F","#FFBD88","#F664AF","#AAF0D1","#CD4A4C","#EDD19C","#979AAA","#FF8243","#C8385A","#EF98AA","#FDBCB4","#1A4876","#30BA8F","#C54B8C","#1974D2","#FFA343","#BAB86C","#FF7538","#FF2B2B","#F8D568","#E6A8D7","#414A4C","#FF6E4A","#1CA9C9","#FFCFAB","#C5D0E6","#FDDDE6","#158078","#FC74FD","#F78FA7","#8E4585","#7442C8","#9D81BA","#FE4EDA","#FF496C","#D68A59","#714B23","#FF48D0","#E3256B","#EE204D","#FF5349","#C0448F","#1FCECB","#7851A9","#FF9BAA","#FC2847","#76FF7A","#93DFB8","#A5694F","#8A795D","#45CEA2","#FB7EFD","#CDC5C2","#80DAEB","#ECEABE","#FFCF48","#FD5E53","#FAA76C","#18A7B5","#EBC7DF","#FC89AC","#DBD7D2","#17806D","#DEAA88","#77DDE7","#FFFF66","#926EAE","#324AB2","#F75394","#FFA089","#8F509D","#FFFFFF","#A2ADD0","#FF43A4","#FC6C85","#CDA4DE","#FCE883","#C5E384","#FFAE42","#EFDECD","#000000"];this.colors=d3.scale.ordinal().range(e)};h.prototype.axisLabelText=function(a,b){var c=this.selection.select("."+a+".axis .label");return check.not.defined(b)?c.empty()?"":c.text():(c.text(b),this.update)},h.prototype.yAxisLabelText=function(a){return this.axisLabelText("y",a)},h.prototype.xAxisLabelText=function(a){return this.axisLabelText("x",a)},h.prototype.setDimension=function(a,b,c){return check.defined(a)?(this.config[c]=a,check.defined(b)&&b(),this.svg.attr(c,this.config[c]),this.updateDimensions(),this.update):this.config[c]},h.prototype.width=function(a,b){return this.setDimension(a,b,"width")},h.prototype.height=function(a,b){return this.setDimension(a,b,"height")},h.prototype.tooltipHtml=function(a){return arguments.length?(this.config.tooltipHtml=a,this.update):this.config.tooltipHtml()};var i=function(a,b,c){for(var d=check.object(a)?JSON.parse(a):a,e=c?Object.keys(d[0]).join()+"\r\n":"",f=0;f<d.length;f++){var g="";for(var h in d[f])d[f].hasOwnProperty(h)&&(g+='"'+d[f][h]+'",');g.slice(0,g.length-1),e+=g+"\r\n"}var i="export";check.string(b)&&(i=b.replace(/ /g,"_"));var j="data:text/csv;charset=utf-8,"+encodeURIComponent(e),k=document.createElement("a");k.href=j,k.style="visibility:hidden",k.download=i+".csv",document.body.appendChild(k),k.click(),document.body.removeChild(k)},j=function(a,b){this.data=b,a=this.selection=d(a)?a:d3.select(a);var c=this.chart=new h(a,"heat-map"),e=this.config=c.config;e.margin.top=55,e.margin.bottom=40,e.margin.right=0,c.updateDimensions();var f=this.dateRange();this.fromX=moment(f.from).toDate(),this.toX=moment(f.to).toDate()};j.prototype.filterDataByDateRange=function(a,b){var c=this;return a.filter(function(a){var d=moment(new Date(a.date));return(d.isAfter(c.fromX,b)||d.isSame(c.fromX,b))&&d.isBefore(c.toX,b)||d.isSame(c.toX,b)})},j.prototype.getDates=function(a,b){var c=this,d=a.map(function(a){return a.date});return d3.set(d).values().filter(function(a){var d=moment(new Date(a));return(d.isAfter(c.fromX,b)||d.isSame(c.fromX,b))&&d.isBefore(c.toX,b)||d.isSame(c.toX,b)})},j.prototype.dateRange=function(){var a=d3.extent(this.data.map(function(a){return a.date}));return{from:a[0],to:a[1]}},j.prototype.displayDateUnit=function(){return moment(this.toX).diff(this.fromX,"months")>=24?"year":"month"},j.prototype.prepareDisplayData=function(){this.displayData={data:this.filterDataByDateRange(this.data,"month"),dateFormat:d3.time.format("%b %Y"),dates:this.getDates(this.data,"month")};var a=this.displayDateUnit();if("year"===a){var b=d3.nest().key(function(a){return a.category}).key(function(a){return new Date(a.date).getFullYear()}).entries(this.data),c=[];b.forEach(function(a){a.values.forEach(function(b){var d=moment(b.key,"YYYY").toDate();c.push({category:a.key,date:d,value:d3.sum(b.values,function(a){return a.value})})})}),this.displayData.data=this.filterDataByDateRange(c,"year"),this.displayData.dates=this.getDates(c,"year"),this.displayData.dateFormat=d3.time.format("%Y")}},j.prototype.preRender=function(){var a=this.displayData,b=this.chart,c=this.chart.config;this.updateCellPrimitives=function(b){this.cellWidth=Math.floor(c.paddedWidth()/a.dates.length),this.categories=d3.set(b.map(function(a){return a.category})).values(),this.cellHeight=Math.floor(c.paddedHeight()/this.categories.length)},this.updateCellPrimitives(a.data),this.colors=["#F7F9F5","#F0F4EC","#E1E9DA","#D2DEC7","#C3D4B5","#B4C9A2","#A5BE90","#96B37D","#87A96B"],this.buckets=this.colors.length,b.xScale=d3.scale.linear(),b.yScale=d3.scale.ordinal(),b.colorScale=d3.scale.quantile(),this.updateX=function(d){this.updateCellPrimitives(d),b.xScale.domain([0,a.dates.length-1]).range([0,c.paddedWidth()-this.cellWidth])},this.updateY=function(a){b.yScale.domain(a.map(function(a){return a.category})).rangeRoundBands([0,c.paddedHeight()+3])},this.updateColors=function(a){b.colorScale.domain([0,this.buckets-1,d3.max(a,function(a){return a.value})]).range(this.colors)},this.updateX(a.data),this.updateY(a.data),this.updateColors(a.data)},j.prototype.renderRectangles=function(){var a=this.chart,b=this.cellHeight,c=this.cellWidth,d=this.categories,e=this.displayData,f=6;if(this.yLabels=a.renderArea.selectAll(".yLabel").data(d).enter().append("text").text(function(a){return a}).attr("x",-f/2).style("text-anchor","end").attr("class","axis yLabel"),!this.yLabels.empty()){var g=d3.max(this.yLabels[0],function(a){return a.getBoundingClientRect().height});this.yLabels.attr("y",function(c){return a.yScale(c)+b/2+g/4}),a.config.margin.left=f+d3.max(this.yLabels[0],function(a){return a.getBoundingClientRect().width}),a.updateDimensions()}if(this.xLabels=a.renderArea.selectAll(".xLabel").data(e.dates).enter().append("text").text(function(a){return e.dateFormat(new Date(a))}).attr("x",0).style("text-anchor","middle").attr("transform","rotate(-90) translate(30, 0)").attr("class","axis xLabel"),!this.xLabels.empty()){var h=d3.max(this.xLabels[0],function(a){return a.getBoundingClientRect().height});this.xLabels.attr("y",function(b,d){return a.xScale(d%e.dates.length)+c/2+h/8})}return this.rectGroups=a.renderArea.selectAll("g").data(e.data).enter().append("g").attr("transform",function(b,c){var d=a.xScale(c%e.dates.length),f=a.yScale(b.category);return"translate("+d+","+f+")"}),this.rectGroups.append("rect").attr("width",c).attr("height",b).style("fill",function(b){return a.colorScale(b.value)}),this.rectGroups.append("text").text(function(a){return a.value}).attr("x",c/2).attr("y",b/2).attr("alignment-baseline","middle").attr("text-anchor","middle"),this},j.prototype.renderLegend=function(){var a=this.chart,b=this.config,c=this.buckets,d=this.colors,e=Math.floor(b.paddedWidth()/c),f=this.legend=a.renderArea.append("g").attr("class","legend"),g=f.selectAll(".legend-item").data([0].concat(a.colorScale.quantiles()),function(a){return a}).enter().append("g").attr("class","legend-item"),h=19;return g.append("rect").attr("x",function(a,b){return e*b}).attr("y",b.paddedHeight()+10).attr("width",e).attr("height",h).style("fill",function(a,b){return d[b]}),g.append("text").text(function(a){return"≥ "+Math.round(a)}).attr("x",function(a,b){return e*b}).attr("y",b.paddedHeight()+2*h+2),this},j.prototype.render=function(){return this.prepareDisplayData(),this.preRender(),this.renderRectangles(),this.renderLegend(),this};var k=function(a,b){var c=new j(a,b).render(),d=c.chart,e=c.chart.update=function(a){b=c.data=check.defined(a)?a:c.data,c.prepareDisplayData(),c.updateColors(c.displayData.data),c.updateX(c.displayData.data),c.updateY(c.displayData.data),c.xLabels.remove(),c.yLabels.remove(),c.rectGroups.remove(),c.legend.remove(),c.render()};return e.width=function(a){return d.width(a,function(){c.updateY(c.data)})},e.height=function(a){return d.height(a,function(){c.updateX(c.data)})},e.margin=function(a){return check.defined(a)?(d.config.margin=a,e):d.config.margin},e.margin.left=function(a){return check.defined(a)?(d.config.margin.left=a,e):d.config.margin.left},e.displayData=function(){return c.displayData},e.fromX=function(a){return check.defined(a)?(c.fromX=a,e):c.fromX},e.toX=function(a){return check.defined(a)?(c.toX=a,e):c.toX},e},l=function(a,b){function c(a){b=check.defined(a)?a:b,f.xScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.x})})]),f.yScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.y})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.y})})]),k=k.data(b),k.exit().remove(),k.enter().append("g").attr("class","series").append("path").attr("d",function(a){return i(a.data)}).style("stroke",function(a){return f.colors(a.name)}),k.select("path").transition().duration(g.transitionDuration).attr("d",function(a){return i(a.data)}).style("stroke",function(a){return f.colors(a.name)}),l.select(".x.axis").transition().duration(g.transitionDuration).call(f.xAxis).attr("transform","translate(0,"+g.paddedHeight()+")"),l.select(".y.axis").transition().duration(g.transitionDuration).call(f.yAxis),k.selectAll(".dots").data(function(a){return a.data.map(function(b){b.name=a.name}),a.data}).transition().duration(g.transitionDuration).attr("cy",function(a){return f.yScale(a.y)}).attr("cx",function(a){return f.xScale(a.x)}),h.series=h.series.data(b),h.series.enter().append("g").attr("class","series").append("path").attr("d",function(a){return j(a.data)}).style("stroke",function(a){return f.colors(a.name)}).attr("class","line"),h.series.select("path").transition().duration(g.transitionDuration).attr("d",function(a){return j(a.data)}).style("stroke",function(a){return f.colors(a.name)}),h.chart.xScale.domain(f.xScale.domain()),h.brush.x(h.chart.xScale).extent([d3.min(b,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.x})})]),m.attr("transform","translate(0,"+(g.paddedHeight()+h.config.margin.bottom+4)+")"),m.select(".x.brush").transition().duration(g.transitionDuration).call(h.brush),m.select(".extent").transition().duration(g.transitionDuration).attr("x",0).attr("width",g.paddedWidth()),m.select(".resize.e").transition().duration(g.transitionDuration).attr("transform","translate("+g.paddedWidth()+",0)"),m.select(".resize.w").transition().duration(g.transitionDuration).attr("transform","translate(0,0)"),m.select(".x.axis").transition().duration(g.transitionDuration).call(h.chart.xAxis).attr("transform","translate(0,"+h.config.height()+")"),p(b),q(b),r()}var d=new e(a,b),f=d.chart,g=f.config,h=d.brushData,i=d.lineGenerator,j=d.brushLineGenerator,k=d.series,l=d.focus,m=d.context,n=d.updateX,o=d.updateY,p=d.renderTooltip,q=d.renderLegend,r=d.sendBrushData;return f.update=c,c.width=function(a){return f.width(a,function(){n(),h.clipping.attr("width",g.paddedWidth()+2*g.dotSize),d.selection.select(".x.axis .label").transition().duration(g.transitionDuration).attr("x",g.paddedWidth()/2).attr("y",28)})},c.height=function(a){return f.height(a,function(){return o(),h.clipping.attr("height",g.paddedHeight()+2*g.dotSize),m.attr("transform","translate(0,"+h.config.height()+")"),m.select(".x.brush").selectAll("rect").attr("height",h.config.height()-5).attr("transform","translate(0,5)"),d.selection.select(".y.axis .label").transition().duration(g.transitionDuration).attr("y",-1*g.margin.left).attr("x",g.paddedHeight()/2*-1),c()})},c.rightMargin=function(a){return arguments.length?(f.config.margin.right=a,n(),h.clipping.attr("width",g.paddedWidth()+2*g.dotSize),p(b),c):f.config.margin.right},c.yAxisLabelText=function(a){return f.yAxisLabelText(a)},c.xAxisLabelText=function(a){return f.xAxisLabelText(a)},c.tooltipHtml=function(a){return f.tooltipHtml(a)},f.hasRenderedOnce=!0,c},m=function(a,b){function c(){var a=-10;return Math.min(g.width,g.height)/2+a}function e(a){b=check.defined(a)?a:b,b.forEach(function(a){a.population=+a.population}),l.data(j(b)).transition().duration(g.transitionDuration).attrTween("d",n),m.data(j(b)).transition().duration(g.transitionDuration).attr("transform",function(a){return"translate("+i.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.age})}a=this.selection=d(a)?a:d3.select(a);var f=new h(a,"pie"),g=f.config;f.updateDimensions=function(){this.svg.attr("width",g.width).attr("height",g.height),f.renderArea.attr("transform","translate("+g.width/2+","+g.height/2+")")},f.updateDimensions();var i=d3.svg.arc().innerRadius(0),j=d3.layout.pie().sort(null).value(function(a){return a.population}),k=function(){i.outerRadius(c())};k(),b.forEach(function(a){a.population=+a.population});var l=f.renderArea.selectAll("path").data(j(b)).enter().append("path").attr("d",i).style("fill",function(a){return f.colors(a.data.age)}).each(function(a){this.currentAngle=a}),m=f.renderArea.selectAll("text").data(j(b)).enter().append("text").attr("transform",function(a){return"translate("+i.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.age}),n=function(a){var b=d3.interpolate(this.currentAngle,a);return this.currentAngle=b(0),function(a){return i(b(a))}};return f.update=e,e.width=function(a){return f.width(a,k)},e.height=function(a){return f.height(a,k)},e},n=d3.select("body").append("div").attr("class","diagrammatica-tooltip").style("opacity",0);document.addEventListener("mousemove",function(a){d3.select(a.toElement).classed("diagrammatica-tooltip-target")||n.style("opacity",0)}),a.BarBase=f,a.bar=g,a.ChartBase=h,a.scrollPosition=c,a.isD3Selection=d,a.toCSV=i,a.HeatMapBase=j,a.heatMap=k,a.LineBase=e,a.line=l,a.pie=m,a.tooltip=n}({},function(){return this}());
//# sourceMappingURL=diagrammatica.min.js.map