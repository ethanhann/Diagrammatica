!function(a,b){"use strict";function c(){if("number"==typeof window.scrollX&&"number"==typeof window.scrollY)return{x:window.scrollX,y:window.scrollY};if("number"==typeof window.pageXOffset&&"number"==typeof window.pageYOffset)return{x:window.pageXOffset,y:window.pageYOffset};var a=document.documentElement||document.body.parentNode;return("number"!=typeof a.ScrollLeft||"number"!=typeof a.ScrollTop)&&(a=document.body),{x:a.scrollLeft,y:a.scrollTop}}function d(a){return a instanceof d3.selection||check.array(a)&&"string"!=typeof a[0]}b.diagrammatica=a;var e=function(a,b,c){a=this.selection=d(a)?a:d3.select(a),this.data=b;var e=this.chart=new g(this.selection,"bar"),f=this.config=e.config;c=this.orientation=c||"horizontal";var h=this.isHorizontal=function(){return"horizontal"===c};e.xScale=d3.scale.ordinal(),e.yScale=d3.scale.linear(),this.updateX=function(a){b=check.defined(a)?a:b;var c=h()?[0,f.paddedHeight()]:[0,f.paddedWidth()];e.xScale.domain(b.map(function(a){return a.name})).rangeRoundBands(c,.1);var d=h()?"left":"bottom";e.xAxis=d3.svg.axis().scale(e.xScale).orient(d)},this.updateY=function(a){b=check.defined(a)?a:b,e.yScale.domain([0,d3.max(b,function(a){return a.value})]);var c=h()?[0,f.paddedWidth()]:[f.paddedHeight(),0];e.yScale.range(c);var d=h()?"bottom":"left";e.yAxis=d3.svg.axis().scale(e.yScale).orient(d)},this.updateX(),this.updateY(),f.tooltipHtml=function(a){var b='<div class="left-arrow diagrammatica-tooltip-inline"></div>';return b+='<div class="diagrammatica-tooltip-content diagrammatica-tooltip-inline">'+a.value+"</div>"}};e.prototype.renderAxis=function(a){var b=this.chart,c=this.config,d=b.renderArea.append("g").attr("class",a+" axis").call(b[a+"Axis"]),e=d.append("text").attr("class",a+" label").attr("text-anchor","middle");return this.isHorizontal()&&"x"===a||!this.isHorizontal()&&"y"===a?e.attr("transform","rotate(-90)").attr("x",c.paddedHeight()/2*-1).attr("y",-1*c.margin.left).attr("dy","1em"):(d.attr("transform","translate(0,"+c.paddedHeight()+")"),e.attr("x",c.paddedWidth()/2).attr("y",28)),this},e.prototype.renderBars=function(){var a=this.chart,b=this.data,d=this.config;this.bars=a.renderArea.selectAll(".bar").data(b).enter().append("rect").attr("class","bar diagrammatica-tooltip-target").attr("fill",function(b){return a.colors(b.value)}).on("mouseover",function(a){m.transition().style("opacity",1);var b=this.getBoundingClientRect(),e=m.node().getBoundingClientRect(),f=(b.height-e.height)/2;m.html(d.tooltipHtml(a)).style("left",b.right+"px").style("top",b.top+c().y+f+"px")}).on("mouseout",function(){m.style("opacity",0)});var e=0,f=function(b){return a.xScale(b.name)},g=function(b){return a.yScale(b.value)},h=a.xScale.rangeBand();return this.isHorizontal()||(e=function(b){return a.xScale(b.name)},f=function(b){return a.yScale(b.value)},g=a.xScale.rangeBand(),h=function(b){return d.paddedHeight()-a.yScale(b.value)}),this.bars.attr("x",e).attr("y",f).attr("width",g).attr("height",h),this},e.prototype.render=function(){return this.renderAxis("x"),this.renderAxis("y"),this.renderBars(),this},e.prototype.updateAxes=function(a){var b=this.chart,c=this.config;this.updateY(a);var d=b.renderArea.select(".y.axis").transition().call(b.yAxis);this.updateX(a);var e=b.renderArea.select(".x.axis").transition().call(b.xAxis),f=this.isHorizontal()?d:e;return f.attr("transform","translate(0,"+c.paddedHeight()+")"),this},e.prototype.updateBars=function(a){var b=this.chart,c=this.bars,d=this.config,e=c.data(a).transition();this.isHorizontal()?e.attr("y",function(a){return b.xScale(a.name)}).attr("width",function(a){return b.yScale(a.value)}).attr("height",b.xScale.rangeBand()):e.attr("x",function(a){return b.xScale(a.name)}).attr("y",function(a){return b.yScale(a.value)}).attr("width",b.xScale.rangeBand()).attr("height",function(a){return d.paddedHeight()-b.yScale(a.value)})};var f=function(a,b,c){var d=new e(a,b,c).render(),f=d.chart,g=d.config,h=d.updateX,i=d.updateY,j=d.bars,k=f.update=function(a){b=check.defined(a)?a:b,d.updateAxes(b),d.updateBars(b)};return k.height=function(a){var b=d.isHorizontal()?"x":"y";return f.height(a,function(){h(),d.selection.select("."+b+".axis .label").transition().attr("y",-1*g.margin.left).attr("x",g.paddedHeight()/2*-1)})},k.width=function(a){var b=d.isHorizontal()?"y":"x";return f.width(a,function(){i(),d.selection.select("."+b+".axis .label").transition().attr("x",g.paddedWidth()/2).attr("y",28)})},k.yAxisLabelText=function(a){return f.yAxisLabelText(a)},k.xAxisLabelText=function(a){return f.xAxisLabelText(a)},k.chartBase=function(){return f},k.updateY=function(){return i},k.updateX=function(){return h},k.bars=function(){return j},k},g=function(a,b){this.hasRenderedOnce=!1,this.selection=d(a)?a:d3.select(a),this.update=function(){};var c={margin:{top:20,right:20,bottom:30,left:40},width:480,height:250};this.config=c,this.config.paddedWidth=function(){return c.width-c.margin.left-c.margin.right},this.config.paddedHeight=function(){return c.height-c.margin.top-c.margin.bottom},this.config.tooltipHtml=function(){return"tooltip content"},this.svg=this.selection.append("svg").attr("class","diagrammatica diagrammatica-"+b).attr("width",c.width).attr("height",c.height),this.renderArea=this.svg.append("g").attr("transform","translate("+c.margin.left+","+c.margin.top+")"),this.updateDimensions=function(){this.svg.attr("width",c.width).attr("height",c.height),this.renderArea.attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")")},this.xScale=function(){},this.xAxis=function(){},this.yScale=function(){},this.yAxis=function(){},this.colors=d3.scale.category10()};g.prototype.axisLabelText=function(a,b){var c=this.selection.select("."+a+".axis .label");return check.not.defined(b)?c.empty()?"":c.text():(c.text(b),this.update)},g.prototype.yAxisLabelText=function(a){return this.axisLabelText("y",a)},g.prototype.xAxisLabelText=function(a){return this.axisLabelText("x",a)},g.prototype.setDimension=function(a,b,c){return check.defined(a)?(this.config[c]=a,check.defined(b)&&b(),this.svg.attr(c,this.config[c]),this.updateDimensions(),this.update):this.config[c]},g.prototype.width=function(a,b){return this.setDimension(a,b,"width")},g.prototype.height=function(a,b){return this.setDimension(a,b,"height")},g.prototype.tooltipHtml=function(a){return arguments.length?(this.config.tooltipHtml=a,this.update):this.config.tooltipHtml()};var h=function(a,b,c){for(var d=check.object(a)?JSON.parse(a):a,e=c?Object.keys(d[0]).join()+"\r\n":"",f=0;f<d.length;f++){var g="";for(var h in d[f])g+='"'+d[f][h]+'",';g.slice(0,g.length-1),e+=g+"\r\n"}var i=b.replace(/ /g,"_"),j="data:text/csv;charset=utf-8,"+encodeURIComponent(e),k=document.createElement("a");k.href=j,k.style="visibility:hidden",k.download=i+".csv",document.body.appendChild(k),k.click(),document.body.removeChild(k)},i=function(a,b){a=this.selection=d(a)?a:d3.select(a),this.data=b;var c=this.chart=new g(a,"heat-map"),e=this.config=c.config;e.margin.top=55,e.margin.bottom=40,e.margin.left=50,c.updateDimensions(),this.updateCellPrimitives=function(a){this.dates=d3.set(a.map(function(a){return a.date})).values(),this.cellWidth=Math.floor(e.paddedWidth()/this.dates.length),this.categories=d3.set(a.map(function(a){return a.category})).values(),this.cellHeight=Math.floor(e.paddedHeight()/this.categories.length)},this.updateCellPrimitives(b),this.colors=["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],this.buckets=this.colors.length,c.xScale=d3.scale.linear(),c.yScale=d3.scale.ordinal(),c.colorScale=d3.scale.quantile(),this.updateX=function(a){this.updateCellPrimitives(a),c.xScale.domain([0,this.dates.length-1]).range([0,e.paddedWidth()-this.cellWidth])},this.updateY=function(a){c.yScale.domain(a.map(function(a){return a.category})).rangeRoundBands([0,e.paddedHeight()+3])},this.updateColors=function(a){c.colorScale.domain([0,this.buckets-1,d3.max(a,function(a){return a.value})]).range(this.colors)},this.updateX(b),this.updateY(b),this.updateColors(b)};i.prototype.renderRectangles=function(){var a=this.chart,b=this.data,c=this.cellHeight,d=this.cellWidth,e=this.dates,f=this.categories;this.yLabels=a.renderArea.selectAll(".yLabel").data(f).enter().append("text").text(function(a){return a}).attr("x",0).attr("y",function(a,b){return b*c}).style("text-anchor","end").attr("transform","translate(-6,"+c/2+")").attr("class","axis");var g=d3.time.format("%b %Y");return this.xLabels=a.renderArea.selectAll(".xLabel").data(e).enter().append("text").text(function(a){return g(new Date(a))}).attr("x",0).attr("y",function(a,b){return b*d}).style("text-anchor","middle").attr("transform",function(b,c){var f=a.xScale(c%e.length)/d+d/2;return"rotate(-90) translate(30, "+f+")"}).attr("class","axis"),this.rectangles=a.renderArea.selectAll("rect").data(b).enter().append("rect").attr("x",function(b,c){return a.xScale(c%e.length)}).attr("y",function(b){return a.yScale(b.category)}).attr("width",d).attr("height",c).style("fill",function(b){return a.colorScale(b.value)}),this.rectangles.append("title").text(function(a){return a.value}),this},i.prototype.renderLegend=function(){var a=this.chart,b=this.config,c=this.buckets,d=this.colors,e=Math.floor(b.paddedWidth()/c),f=this.legend=a.renderArea.append("g").attr("class","legend"),g=f.selectAll(".legend-item").data([0].concat(a.colorScale.quantiles()),function(a){return a}).enter().append("g").attr("class","legend-item"),h=19;return g.append("rect").attr("x",function(a,b){return e*b}).attr("y",b.paddedHeight()+10).attr("width",e).attr("height",h).style("fill",function(a,b){return d[b]}),g.append("text").text(function(a){return"â‰¥ "+Math.round(a)}).attr("x",function(a,b){return e*b}).attr("y",b.paddedHeight()+2*h+2),this},i.prototype.render=function(){return this.renderRectangles(),this.renderLegend(),this};var j=function(a,b){var c=new i(a,b).render(),d=c.chart,e=c.chart.update=function(a){b=c.data=check.defined(a)?a:c.data,c.updateColors(b),c.updateX(b),c.updateY(b),c.xLabels.remove(),c.yLabels.remove(),c.rectangles.remove(),c.legend.remove(),c.render()};return e.width=function(a){return d.width(a,function(){c.updateY(c.data)})},e},k=function(a,b){function c(){j.xScale=d3.time.scale().range([0,k.paddedWidth()]),j.xAxis=d3.svg.axis().scale(j.xScale).orient("bottom")}function e(){j.yScale=d3.scale.linear().range([k.paddedHeight(),0]),j.yAxis=d3.svg.axis().scale(j.yScale).orient("left")}function f(a){s.attr("y2",k.paddedHeight()),t.selectAll(".tooltip-rect").remove();var b=k.paddedWidth()/a.length,c=b/2;t.selectAll(".tooltip-rect").data(a[0].data).enter().append("rect").attr("height",k.paddedHeight()).attr("width",b).attr("opacity",0).classed("tooltip-rect",!0).classed("diagrammatica-tooltip-target",!0).attr("x",function(a){return j.xScale(a.x)-c}).on("mouseover",function(b){s.attr("x1",j.xScale(b.x)).attr("x2",j.xScale(b.x)).style("opacity",1),m.transition().style("opacity",1);var c=this.getBoundingClientRect(),d=m.node().getBoundingClientRect(),e=c.left+c.width/2;e+=b===a[0].data[a[0].data.length-1]?-Math.abs(d.width+10):10;var f=a.map(function(a){var c=a.data.filter(function(a){return a.x.getTime()===b.x.getTime()}),d=1===c.length?c[0]:{};return d.name=a.name,d});m.html(k.tooltipHtml(f)).style("left",e+"px").style("top",d3.event.pageY+"px")}).on("mousemove",function(){m.style("top",d3.event.pageY+"px")}).on("mouseout",function(){s.style("opacity",0),m.style("opacity",0)})}function h(a){var b,c=a.map(function(a){return{name:a.name}}),d=u.selectAll("g").data(c).enter().append("g").attr("class","legend-item").on("mouseover",function(a){d.transition().attr("opacity",function(b){return a===b?1:.3}),q.transition().attr("opacity",function(b){return a.name===b.name?1:0})}).on("mouseout",function(){check.object(b)?(d.transition().attr("opacity",function(a){return a===b?1:.3}),q.transition().attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0})):(d.transition().attr("opacity",1),q.transition().attr("opacity",1))}).on("click",function(a){b=b===a?null:a,check.object(b)?q.attr("opacity",function(a){return check.object(b)&&a.name===b.name?1:0}):q.attr("opacity",1)});d.append("text").text(function(a){return a.name}).each(function(a){a.width=this.getBBox().width}),d.append("rect").attr("class","legend-item-swatch").attr("height",10).attr("width",10).attr("x",-12).attr("y",-10).attr("fill",function(a){return j.colors(a.name)});var e=0;d.attr("transform",function(a,b){return e+=b>0?c[b-1].width+20:0,"translate("+e+",0)"}),j.hasRenderedOnce?u.transition().duration(1e3).attr("transform","translate("+[(k.paddedWidth()-u.node().getBBox().width)/2,k.height-25].join()+")"):u.attr("transform","translate("+[(k.paddedWidth()-u.node().getBBox().width)/2,k.height-25].join()+")")}function i(a){a.forEach(function(a){a.data.forEach(function(a){a.x=l(a.x),a.y=+a.y})}),j.xScale.domain([d3.min(a,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(a,function(a){return d3.max(a.data,function(a){return a.x})})]),j.yScale.domain([d3.min(a,function(a){return d3.min(a.data,function(a){return a.y})}),d3.max(a,function(a){return d3.max(a.data,function(a){return a.y})})]),p=p.data(a),p.exit().remove(),p.enter().append("g").attr("class","series").append("path").attr("d",function(a){return o(a.data)}).style("stroke",function(a){return j.colors(a.name)}).attr("class","line"),p.select("path").transition().duration(1e3).attr("d",function(a){return o(a.data)}).style("stroke",function(a){return j.colors(a.name)}),j.renderArea.select(".x.axis").transition().duration(1e3).call(j.xAxis).attr("transform","translate(0,"+k.paddedHeight()+")"),j.renderArea.select(".y.axis").transition().duration(1e3).call(j.yAxis),f(a),h(a)}a=this.selection=d(a)?a:d3.select(a);var j=new g(a,"line"),k=j.config;k.margin.bottom=50;var l=d3.time.format("%d-%b-%y").parse,n=d3.time.format("%e %B");c(),e();var o=d3.svg.line().x(function(a){return j.xScale(a.x)}).y(function(a){return j.yScale(a.y)});b.forEach(function(a){a.data.forEach(function(a){a.x=l(a.x),a.y=+a.y})}),j.xScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.x})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.x})})]),j.yScale.domain([d3.min(b,function(a){return d3.min(a.data,function(a){return a.y})}),d3.max(b,function(a){return d3.max(a.data,function(a){return a.y})})]),j.renderArea.append("g").attr("class","x axis").attr("transform","translate(0,"+k.paddedHeight()+")").call(j.xAxis).append("text").attr("class","x label").attr("text-anchor","middle").attr("x",k.paddedWidth()/2).attr("y",28).text(""),j.renderArea.append("g").attr("class","y axis").call(j.yAxis).append("text").attr("class","y label").attr("transform","rotate(-90)").attr("y",-1*k.margin.left).attr("x",k.paddedHeight()/2*-1).attr("dy","1em").style("text-anchor","middle").text("");var p=j.renderArea.selectAll("series").data(b).enter().append("g").attr("class","series"),q=p.append("path").attr("class","line").attr("d",function(a){return o(a.data)}).style("stroke",function(a){return j.colors(a.name)}),r=j.renderArea.append("g").attr("class","hover-line"),s=r.append("line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",k.paddedHeight());s.style("opacity",0);var t=j.renderArea.append("g").attr("class","tooltip-rect-group");k.tooltipHtml=function(a){var b="";return b+='<div class="diagrammatica-tooltip-content">',a.forEach(function(a){b+='<svg height="10" width="10"><rect height="10" width="10" fill="'+j.colors(a.name)+'"></rect></svg>',b+="<span> "+a.name+"</span> : "+n(a.x)+" : "+a.y+"<br>"}),b+="</div>"},f(b);var u=j.renderArea.append("g").attr("class","legend");return h(b),j.update=i,i.width=function(b){return j.width(b,function(){c(),a.select(".x.axis .label").transition().duration(1e3).attr("x",k.paddedWidth()/2).attr("y",28)})},i.height=function(b){return j.height(b,function(){e(),a.select(".y.axis .label").transition().duration(1e3).attr("y",-1*k.margin.left).attr("x",k.paddedHeight()/2*-1)})},i.yAxisLabelText=function(a){return j.yAxisLabelText(a)},i.xAxisLabelText=function(a){return j.xAxisLabelText(a)},i.tooltipHtml=function(a){return j.tooltipHtml(a)},j.hasRenderedOnce=!0,i},l=function(a,b){function c(){var a=-10;return Math.min(h.width,h.height)/2+a}function e(a){b=check.defined(a)?a:b,b.forEach(function(a){a.population=+a.population}),l.data(j(b)).transition().duration(500).attrTween("d",n),m.data(j(b)).transition().duration(500).attr("transform",function(a){return"translate("+i.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.age})}a=this.selection=d(a)?a:d3.select(a);var f=new g(a,"pie"),h=f.config;f.updateDimensions=function(){this.svg.attr("width",h.width).attr("height",h.height),f.renderArea.attr("transform","translate("+h.width/2+","+h.height/2+")")},f.updateDimensions();var i=d3.svg.arc().innerRadius(0),j=d3.layout.pie().sort(null).value(function(a){return a.population}),k=function(){i.outerRadius(c())};k(),b.forEach(function(a){a.population=+a.population});var l=f.renderArea.selectAll("path").data(j(b)).enter().append("path").attr("d",i).style("fill",function(a){return f.colors(a.data.age)}).each(function(a){this.currentAngle=a}),m=f.renderArea.selectAll("text").data(j(b)).enter().append("text").attr("transform",function(a){return"translate("+i.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.age}),n=function(a){var b=d3.interpolate(this.currentAngle,a);return this.currentAngle=b(0),function(a){return i(b(a))}};return f.update=e,e.width=function(a){return f.width(a,k)},e.height=function(a){return f.height(a,k)},e},m=d3.select("body").append("div").attr("class","diagrammatica-tooltip").style("opacity",0);document.addEventListener("mousemove",function(a){d3.select(a.toElement).classed("diagrammatica-tooltip-target")||m.style("opacity",0)}),a.BarBase=e,a.bar=f,a.ChartBase=g,a.scrollPosition=c,a.isD3Selection=d,a.toCommaSeparatedList=h,a.HeatMapBase=i,a.heatMap=j,a.line=k,a.pie=l,a.tooltip=m}({},function(){return this}());
//# sourceMappingURL=diagrammatica.min.js.map